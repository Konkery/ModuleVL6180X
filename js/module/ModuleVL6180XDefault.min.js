var regAddr={IDENTIFICATION__MODEL_ID:0,IDENTIFICATION__MODEL_REV_MAJOR:1,IDENTIFICATION__MODEL_REV_MINOR:2,IDENTIFICATION__MODULE_REV_MAJOR:3,IDENTIFICATION__MODULE_REV_MINOR:4,IDENTIFICATION__DATE_HI:6,IDENTIFICATION__DATE_LO:7,IDENTIFICATION__TIME:8,SYSTEM__MODE_GPIO0:16,SYSTEM__MODE_GPIO1:17,SYSTEM__HISTORY_CTRL:18,SYSTEM__INTERRUPT_CONFIG_GPIO:20,SYSTEM__INTERRUPT_CLEAR:21,SYSTEM__FRESH_OUT_OF_RESET:22,SYSTEM__GROUPED_PARAMETER_HOLD:23,SYSRANGE__START:24,SYSRANGE__THRESH_HIGH:25,SYSRANGE__THRESH_LOW:26,SYSRANGE__INTERMEASUREMENT_PERIOD:27,SYSRANGE__MAX_CONVERGENCE_TIME:28,SYSRANGE__CROSSTALK_COMPENSATION_RATE:30,SYSRANGE__CROSSTALK_VALID_HEIGHT:33,SYSRANGE__EARLY_CONVERGENCE_ESTIMATE:34,SYSRANGE__PART_TO_PART_RANGE_OFFSET:36,SYSRANGE__RANGE_IGNORE_VALID_HEIGHT:37,SYSRANGE__RANGE_IGNORE_THRESHOLD:38,SYSRANGE__MAX_AMBIENT_LEVEL_MULT:44,SYSRANGE__RANGE_CHECK_ENABLES:45,SYSRANGE__VHV_RECALIBRATE:46,SYSRANGE__VHV_REPEAT_RATE:49,SYSALS__START:56,SYSALS__THRESH_HIGH:58,SYSALS__THRESH_LOW:60,SYSALS__INTERMEASUREMENT_PERIOD:62,SYSALS__ANALOGUE_GAIN:63,SYSALS__INTEGRATION_PERIOD:64,RESULT__RANGE_STATUS:77,RESULT__ALS_STATUS:78,RESULT__INTERRUPT_STATUS_GPIO:79,RESULT__ALS_VAL:80,RESULT__HISTORY_BUFFER_0:82,RESULT__HISTORY_BUFFER_1:84,RESULT__HISTORY_BUFFER_2:86,RESULT__HISTORY_BUFFER_3:88,RESULT__HISTORY_BUFFER_4:90,RESULT__HISTORY_BUFFER_5:92,RESULT__HISTORY_BUFFER_6:94,RESULT__HISTORY_BUFFER_7:96,RESULT__RANGE_VAL:98,RESULT__RANGE_RAW:100,RESULT__RANGE_RETURN_RATE:102,RESULT__RANGE_REFERENCE_RATE:104,RESULT__RANGE_RETURN_SIGNAL_COUNT:108,RESULT__RANGE_REFERENCE_SIGNAL_COUNT:112,RESULT__RANGE_RETURN_AMB_COUNT:116,RESULT__RANGE_REFERENCE_AMB_COUNT:120,RESULT__RANGE_RETURN_CONV_TIME:124,RESULT__RANGE_REFERENCE_CONV_TIME:128,RANGE_SCALER:150,READOUT__AVERAGING_SAMPLE_PERIOD:266,FIRMWARE__BOOTUP:281,FIRMWARE__RESULT_SCALER:288,I2C_SLAVE__DEVICE_ADDRESS:530,INTERLEAVED_MODE__ENABLE:675},VL6180X=function(opts){(opts=opts||{}).irqPin?(this._irqPin=opts.irqPin,opts.i2c?(this._i2c=opts.i2c,this._address=41,this._scaling=0,this._ptpOffset=0,this._scalerValues=new Uint16Array([0,253,127,84]),this._init(),opts.notDefault||this._configureDefault(),setWatch(this._handleIrq.bind(this),this._irqPin,{repeat:!0,edge:"rising"}),this._waitForRange=!1,this._waitForRangeCallback=null,this._waitForALS=!1,this._waitForALSCallback=null):print("ERROR: you have setup I2C")):print("ERROR: you have setup irqPin")};VL6180X.prototype._handleIrq=function(){if(this._waitForRange){this._waitForRange=!1;var range=this._read8bit(regAddr.RESULT__RANGE_VAL);this._write8bit(regAddr.SYSTEM__INTERRUPT_CLEAR,1),this._waitForRangeCallback&&(255===range?this._waitForRangeCallback({msg:"out of range"},range):this._waitForRangeCallback(!1,range))}else if(this._waitForALS){this._waitForALS=!1;var ambient=this._read16bit(regAddr.RESULT__ALS_VAL);this._write8bit(regAddr.SYSTEM__INTERRUPT_CLEAR,2),this._waitForALSCallback&&(0===ambient?this._waitForRangeCallback({msg:"out of range"},ambient):(ambient=.32*ambient/1.01,this._waitForALSCallback(!1,ambient)))}},VL6180X.prototype._init=function(){if(this._ptpOffset=this._read8bit(regAddr.SYSRANGE__PART_TO_PART_RANGE_OFFSET),1===this._read8bit(regAddr.SYSTEM__FRESH_OUT_OF_RESET))this._scaling=1,this._write8bit(519,1),this._write8bit(520,1),this._write8bit(150,0),this._write8bit(151,253),this._write8bit(227,0),this._write8bit(228,4),this._write8bit(229,2),this._write8bit(230,1),this._write8bit(231,3),this._write8bit(245,2),this._write8bit(217,5),this._write8bit(219,206),this._write8bit(220,3),this._write8bit(221,248),this._write8bit(159,0),this._write8bit(163,60),this._write8bit(183,0),this._write8bit(187,60),this._write8bit(178,9),this._write8bit(202,9),this._write8bit(408,1),this._write8bit(432,23),this._write8bit(429,0),this._write8bit(255,5),this._write8bit(256,5),this._write8bit(409,5),this._write8bit(422,27),this._write8bit(428,62),this._write8bit(423,31),this._write8bit(48,0),this._write8bit(regAddr.SYSTEM__FRESH_OUT_OF_RESET,0);else{var s=this._read16bit(regAddr.RANGE_SCALER);s===this._scalerValues[3]?this._scaling=3:s===this._scalerValues[2]?this._scaling=2:this._scaling=1,this._ptpOffset*=this._scaling}},VL6180X.prototype._write8bit=function(reg,val8bit){this._i2c.writeTo(this._address,reg>>8&255,255&reg,val8bit)},VL6180X.prototype._write16bit=function(reg,val16bit){this._i2c.writeTo(this._address,reg>>8&255,255&reg,val16bit>>8&255,255&val16bit)},VL6180X.prototype._write32bit=function(reg,val32bit){this._i2c.writeTo(this._address,reg>>8&255,255&reg,val32bit>>24&255,val32bit>>16&255,val32bit>>8&255,255&val32bit)},VL6180X.prototype._read8bit=function(reg){var data;return this._i2c.writeTo(this._address,reg>>8&255,255&reg),this._i2c.readFrom(this._address,1)[0]},VL6180X.prototype._read16bit=function(reg){this._i2c.writeTo(this._address,reg>>8&255,255&reg);var data=this._i2c.readFrom(this._address,2);return(data[0]<<8)+data[1]},VL6180X.prototype._read32bit=function(reg){this._i2c.writeTo(this._address,reg>>8&255,255&reg);var data=this._i2c.readFrom(this._address,4);return(data[0]<<24)+(data[1]<<16)+(data[2]<<8)+data[3]},VL6180X.prototype.setAddress=function(newAddr){this._write8bit(regAddr.I2C_SLAVE__DEVICE_ADDRESS,127&newAddr),this._address=newAddr},VL6180X.prototype._configureDefault=function(){this._write8bit(regAddr.SYSTEM__MODE_GPIO1,48),this._write8bit(regAddr.READOUT__AVERAGING_SAMPLE_PERIOD,48),this._write8bit(regAddr.SYSALS__ANALOGUE_GAIN,70),this._write8bit(regAddr.SYSRANGE__VHV_REPEAT_RATE,255),this._write16bit(regAddr.SYSALS__INTEGRATION_PERIOD,99),this._write8bit(regAddr.SYSRANGE__VHV_RECALIBRATE,1),this._write8bit(regAddr.SYSRANGE__INTERMEASUREMENT_PERIOD,9),this._write8bit(regAddr.SYSALS__INTERMEASUREMENT_PERIOD,49),this._write8bit(regAddr.SYSTEM__INTERRUPT_CONFIG_GPIO,36),this._write8bit(regAddr.SYSRANGE__MAX_CONVERGENCE_TIME,49),this._write8bit(regAddr.INTERLEAVED_MODE__ENABLE,0),this.setScaling(1)},VL6180X.prototype.setScaling=function(newScaling){var DefaultCrosstalkValidHeight=20;if(!(newScaling<1||newScaling>3)){this._scaling=newScaling,this._write16bit(regAddr.RANGE_SCALER,this._scalerValues[this._scaling]),this._write8bit(regAddr.SYSRANGE__PART_TO_PART_RANGE_OFFSET,this._ptpOffset/this._scaling),this._write8bit(regAddr.SYSRANGE__CROSSTALK_VALID_HEIGHT,20/this._scaling);var rce=this._read8bit(regAddr.SYSRANGE__RANGE_CHECK_ENABLES);this._write8bit(regAddr.SYSRANGE__RANGE_CHECK_ENABLES,254&rce|1===this._scaling)}},VL6180X.prototype.range=function(callback){this._write8bit(regAddr.SYSRANGE__START,1),this._write8bit(regAddr.SYSTEM__INTERRUPT_CLEAR,1),this._waitForRange=!0,this._waitForRangeCallback=callback},VL6180X.prototype.ambient=function(callback){this._write8bit(regAddr.SYSTEM__INTERRUPT_CLEAR,2),this._write8bit(regAddr.SYSALS__START,1),this._waitForALS=!0,this._waitForALSCallback=callback},exports={ClassVL6180XDefault:VL6180X,registers:regAddr};
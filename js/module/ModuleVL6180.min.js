class ClassBaseVL6180{constructor(_opt){if(!(_opt&&_opt.i2c instanceof I2C&&_opt.irqPin instanceof Pin))throw new err(ClassBaseVL6180.ERROR_MSG_ARG_VALUE,ClassBaseVL6180.ERROR_CODE_ARG_VALUE);this._IrqPin=_opt.irqPin,this._I2Cbus=_opt.i2c,this._WaitForRange=!1,this._WaitForRangeCallback=null,this._Range=void 0,this._WaitForALS=!1,this._WaitForALSCallback=null,this._Illuminance=void 0,this.regAddr={IDENTIFICATION__MODEL_ID:0,IDENTIFICATION__MODEL_REV_MAJOR:1,IDENTIFICATION__MODEL_REV_MINOR:2,IDENTIFICATION__MODULE_REV_MAJOR:3,IDENTIFICATION__MODULE_REV_MINOR:4,IDENTIFICATION__DATE_HI:6,IDENTIFICATION__DATE_LO:7,IDENTIFICATION__TIME:8,SYSTEM__MODE_GPIO0:16,SYSTEM__MODE_GPIO1:17,SYSTEM__HISTORY_CTRL:18,SYSTEM__INTERRUPT_CONFIG_GPIO:20,SYSTEM__INTERRUPT_CLEAR:21,SYSTEM__FRESH_OUT_OF_RESET:22,SYSTEM__GROUPED_PARAMETER_HOLD:23,SYSRANGE__START:24,SYSRANGE__THRESH_HIGH:25,SYSRANGE__THRESH_LOW:26,SYSRANGE__INTERMEASUREMENT_PERIOD:27,SYSRANGE__MAX_CONVERGENCE_TIME:28,SYSRANGE__CROSSTALK_COMPENSATION_RATE:30,SYSRANGE__CROSSTALK_VALID_HEIGHT:33,SYSRANGE__EARLY_CONVERGENCE_ESTIMATE:34,SYSRANGE__PART_TO_PART_RANGE_OFFSET:36,SYSRANGE__RANGE_IGNORE_VALID_HEIGHT:37,SYSRANGE__RANGE_IGNORE_THRESHOLD:38,SYSRANGE__MAX_AMBIENT_LEVEL_MULT:44,SYSRANGE__RANGE_CHECK_ENABLES:45,SYSRANGE__VHV_RECALIBRATE:46,SYSRANGE__VHV_REPEAT_RATE:49,SYSALS__START:56,SYSALS__THRESH_HIGH:58,SYSALS__THRESH_LOW:60,SYSALS__INTERMEASUREMENT_PERIOD:62,SYSALS__ANALOGUE_GAIN:63,SYSALS__INTEGRATION_PERIOD:64,RESULT__RANGE_STATUS:77,RESULT__ALS_STATUS:78,RESULT__INTERRUPT_STATUS_GPIO:79,RESULT__ALS_VAL:80,RESULT__HISTORY_BUFFER_0:82,RESULT__HISTORY_BUFFER_1:84,RESULT__HISTORY_BUFFER_2:86,RESULT__HISTORY_BUFFER_3:88,RESULT__HISTORY_BUFFER_4:90,RESULT__HISTORY_BUFFER_5:92,RESULT__HISTORY_BUFFER_6:94,RESULT__HISTORY_BUFFER_7:96,RESULT__RANGE_VAL:98,RESULT__RANGE_RAW:100,RESULT__RANGE_RETURN_RATE:102,RESULT__RANGE_REFERENCE_RATE:104,RESULT__RANGE_RETURN_SIGNAL_COUNT:108,RESULT__RANGE_REFERENCE_SIGNAL_COUNT:112,RESULT__RANGE_RETURN_AMB_COUNT:116,RESULT__RANGE_REFERENCE_AMB_COUNT:120,RESULT__RANGE_RETURN_CONV_TIME:124,RESULT__RANGE_REFERENCE_CONV_TIME:128,RANGE_SCALER:150,READOUT__AVERAGING_SAMPLE_PERIOD:266,FIRMWARE__BOOTUP:281,FIRMWARE__RESULT_SCALER:288,I2C_SLAVE__DEVICE_ADDRESS:530,INTERLEAVED_MODE__ENABLE:675},setWatch(this.HandleIrq.bind(this),this._IrqPin,{repeat:!0,edge:"rising",debounce:10})}static get ERROR_CODE_ARG_VALUE(){return 10}static get ERROR_MSG_ARG_VALUE(){return`ERROR>> invalid data. ClassID: ${this.name}`}get ALS_MIN_TIME(){return 150}get RANGE_MIN_TIME(){return 50}Init(){this._address=41,this._scaling=0,this._ptpOffset=0,this._scalerValues=new Uint16Array([0,253,127,84]),this._init(),this._configureDefault()}EnableSetWatch(){}UpdateRange(callback){this._WaitForRange||this._WaitForALS||(this._WaitForRange=!0,this._write8bit(this.regAddr.SYSRANGE__START,1),this._write8bit(this.regAddr.SYSTEM__INTERRUPT_CLEAR,1),callback&&(this._WaitForRangeCallback=callback))}UpdateIlluminance(callback){this._WaitForALS||this._WaitForRange||(this._WaitForALS=!0,this._write8bit(this.regAddr.SYSTEM__INTERRUPT_CLEAR,2),this._write8bit(this.regAddr.SYSALS__START,1),callback&&(this._WaitForALSCallback=callback))}HandleRangeUpdate(){this._WaitForRange=!1;var range=this._read8bit(this.regAddr.RESULT__RANGE_VAL);this._write8bit(this.regAddr.SYSTEM__INTERRUPT_CLEAR,1),this._Range=255===range?1/0:range,this._WaitForRangeCallback&&this._WaitForRangeCallback(this._Range)}HandlelluminanceUpdate(){this._WaitForALS=!1;var ambient=this._read16bit(this.regAddr.RESULT__ALS_VAL);this._write8bit(this.regAddr.SYSTEM__INTERRUPT_CLEAR,2),ambient=.32*ambient/1.01,this._Illuminance=ambient,this._Ee&&this._Ee.emit("ALSChange",[this._Illuminance])}HandleIrq(){this._WaitForALS?this.HandleIlluminanceUpdate():this._WaitForRange&&this.HandleRangeUpdate()}}ClassBaseVL6180.prototype._init=function(){if(this._ptpOffset=this._read8bit(this.regAddr.SYSRANGE__PART_TO_PART_RANGE_OFFSET),1===this._read8bit(this.regAddr.SYSTEM__FRESH_OUT_OF_RESET))this._scaling=1,this._write8bit(519,1),this._write8bit(520,1),this._write8bit(150,0),this._write8bit(151,253),this._write8bit(227,0),this._write8bit(228,4),this._write8bit(229,2),this._write8bit(230,1),this._write8bit(231,3),this._write8bit(245,2),this._write8bit(217,5),this._write8bit(219,206),this._write8bit(220,3),this._write8bit(221,248),this._write8bit(159,0),this._write8bit(163,60),this._write8bit(183,0),this._write8bit(187,60),this._write8bit(178,9),this._write8bit(202,9),this._write8bit(408,1),this._write8bit(432,23),this._write8bit(429,0),this._write8bit(255,5),this._write8bit(256,5),this._write8bit(409,5),this._write8bit(422,27),this._write8bit(428,62),this._write8bit(423,31),this._write8bit(48,0),this._write8bit(this.regAddr.SYSTEM__FRESH_OUT_OF_RESET,0);else{var s=this._read16bit(this.regAddr.RANGE_SCALER);s===this._scalerValues[3]?this._scaling=3:s===this._scalerValues[2]?this._scaling=2:this._scaling=1,this._ptpOffset*=this._scaling}},ClassBaseVL6180.prototype._write8bit=function(reg,val8bit){this._I2Cbus.writeTo(this._address,reg>>8&255,255&reg,val8bit)},ClassBaseVL6180.prototype._write16bit=function(reg,val16bit){this._I2Cbus.writeTo(this._address,reg>>8&255,255&reg,val16bit>>8&255,255&val16bit)},ClassBaseVL6180.prototype._write32bit=function(reg,val32bit){this._I2Cbus.writeTo(this._address,reg>>8&255,255&reg,val32bit>>24&255,val32bit>>16&255,val32bit>>8&255,255&val32bit)},ClassBaseVL6180.prototype._read8bit=function(reg){var data;return this._I2Cbus.writeTo(this._address,reg>>8&255,255&reg),this._I2Cbus.readFrom(this._address,1)[0]},ClassBaseVL6180.prototype._read16bit=function(reg){this._I2Cbus.writeTo(this._address,reg>>8&255,255&reg);var data=this._I2Cbus.readFrom(this._address,2);return(data[0]<<8)+data[1]},ClassBaseVL6180.prototype._read32bit=function(reg){this._I2Cbus.writeTo(this._address,reg>>8&255,255&reg);var data=this._I2Cbus.readFrom(this._address,4);return(data[0]<<24)+(data[1]<<16)+(data[2]<<8)+data[3]},ClassBaseVL6180.prototype.setAddress=function(newAddr){this._write8bit(this.regAddr.I2C_SLAVE__DEVICE_ADDRESS,127&newAddr),this._address=newAddr},ClassBaseVL6180.prototype._configureDefault=function(){this._write8bit(this.regAddr.SYSTEM__MODE_GPIO1,48),this._write8bit(this.regAddr.READOUT__AVERAGING_SAMPLE_PERIOD,48),this._write8bit(this.regAddr.SYSALS__ANALOGUE_GAIN,70),this._write8bit(this.regAddr.SYSRANGE__VHV_REPEAT_RATE,255),this._write16bit(this.regAddr.SYSALS__INTEGRATION_PERIOD,99),this._write8bit(this.regAddr.SYSRANGE__VHV_RECALIBRATE,1),this._write8bit(this.regAddr.SYSRANGE__INTERMEASUREMENT_PERIOD,9),this._write8bit(this.regAddr.SYSALS__INTERMEASUREMENT_PERIOD,49),this._write8bit(this.regAddr.SYSTEM__INTERRUPT_CONFIG_GPIO,36),this._write8bit(this.regAddr.SYSRANGE__MAX_CONVERGENCE_TIME,49),this._write8bit(this.regAddr.INTERLEAVED_MODE__ENABLE,0),this.setScaling(1)},ClassBaseVL6180.prototype.setScaling=function(newScaling){var DefaultCrosstalkValidHeight=20;if(!(newScaling<1||newScaling>3)){this._scaling=newScaling,this._write16bit(this.regAddr.RANGE_SCALER,this._scalerValues[this._scaling]),this._write8bit(this.regAddr.SYSRANGE__PART_TO_PART_RANGE_OFFSET,this._ptpOffset/this._scaling),this._write8bit(this.regAddr.SYSRANGE__CROSSTALK_VALID_HEIGHT,20/this._scaling);var rce=this._read8bit(this.regAddr.SYSRANGE__RANGE_CHECK_ENABLES);this._write8bit(this.regAddr.SYSRANGE__RANGE_CHECK_ENABLES,254&rce|1===this._scaling)}};class ClassVL6180 extends ClassBaseVL6180{constructor(_opt){super(_opt),this._RangeCalibrationOpt={k:1,a:0},this._ALSCalibrationOpt={k:1,a:0}}get isBusy(){return this._WaitForALS||this._WaitForRange}get range(){return this._Range*this._RangeCalibrationOpt.k+this._RangeCalibrationOpt.a}get illumination(){return this._Illuminance*this._ALSCalibrationOpt.k+this._ALSCalibrationOpt.a}startRangeMeasures(period,duration){if((duration=duration>=(period=period>=20?period:20)?duration:1/0)!==1/0){let timer=setTimeout(()=>{fn=null},duration-19)}let fn=()=>{this.UpdateRange(),setTimeout(()=>{fn&&fn()},period)};fn&&fn(),this.startDualMeasures.cancel=function(){fn=null}}stopRangeMeasures(){this.startRangeMeasures.cancel()}startALSMeasures(period,duration){if((duration=duration>=(period=period>=110?period:110)?duration:1/0)!==1/0){let timer=setTimeout(()=>{fn=null},duration-109)}let fn=()=>{this.UpdateIlluminance(),setTimeout(()=>{fn&&fn()},period)};fn&&fn(),this.startALSMeasures.cancel=function(){fn=null}}stopALSMeasures(){this.startALSMeasures.cancel()}startDualMeasures(period,duration){if((duration=duration>(period=period>160?period:160)?duration:1/0)!==1/0){let globalTimer=setTimeout(()=>{fn=null},duration-130)}let fn=()=>{this.UpdateIlluminance(),setTimeout(()=>{this.startRangeMeasures(20,period-140)},120),setTimeout(()=>{fn&&fn()},period)};fn&&fn(),this.startDualMeasures.cancel=function(){fn=null}}stopDualMeasures(){this.startDualMeasures.cancel()}calibrateRange(_k,_a){this._RangeCalibrationOpt.k=_k,this._RangeCalibrationOpt.a=_a}calibrateALS(_k,_a){this._ALSCalibrationOpt.k=_k,this._ALSCalibrationOpt.a=_a}}module.export=ClassBaseVL6180;